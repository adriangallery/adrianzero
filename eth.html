<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdrianLAB Kit Sale - Get Everything in One Purchase</title>
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', monospace;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #0a0a0a 100%);
            color: #ffffff;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Hero Section */
        .hero {
            min-height: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 80px 20px 20px 20px;
            position: relative;
            background: radial-gradient(circle at 50% 50%, rgba(0, 255, 0, 0.1) 0%, transparent 50%);
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 255, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 0, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.5;
            z-index: -1;
        }

        .hero h1 {
            font-size: 4rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #00ff00, #00ccff, #ff0088);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            animation: glow 3s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { 
                filter: drop-shadow(0 0 20px rgba(0, 255, 0, 0.5));
            }
            to { 
                filter: drop-shadow(0 0 40px rgba(0, 255, 0, 0.8));
            }
        }

        .hero .subtitle {
            font-size: 1.8rem;
            color: #cccccc;
            margin-bottom: 30px;
            max-width: 600px;
        }

        .hero .description {
            font-size: 1.4rem;
            color: #888888;
            margin-bottom: 20px;
            max-width: 800px;
        }

        /* Wallet Connection */
        .wallet-section {
            margin-bottom: 25px;
            text-align: center;
        }

        .connect-btn {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            color: #000;
            border: none;
            padding: 20px 40px;
            font-size: 1.5rem;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 255, 0, 0.3);
            text-decoration: none;
            display: inline-block;
            margin: 0;
            font-weight: bold;
        }

        .connect-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 255, 0, 0.5);
            background: linear-gradient(45deg, #00ff44, #00ee00);
        }

        .wallet-info {
            display: none;
            background: rgba(0, 170, 255, 0.1);
            border: 1px solid rgba(0, 170, 255, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 20px auto;
            max-width: 400px;
        }

        .wallet-address {
            font-family: monospace;
            font-size: 1.2rem;
            color: #00aaff;
            margin-bottom: 10px;
        }

        /* Kit Sale Section */
        .kit-section {
            min-height: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px 20px 20px;
            position: relative;
            background: radial-gradient(circle at 50% 50%, rgba(0, 255, 0, 0.1) 0%, transparent 50%);
            max-width: 1400px;
            margin: 0 auto;
        }

        .kit-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 255, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 0, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.5;
            z-index: -1;
        }

        .section-title {
            text-align: center;
            font-size: 3rem;
            margin-bottom: 20px;
            color: #00ff00;
            filter: drop-shadow(0 0 20px rgba(0, 255, 0, 0.5));
        }

        .section-subtitle {
            text-align: center;
            font-size: 1.5rem;
            color: #888;
            margin-bottom: 60px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Kit Container */
        .kit-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            margin-bottom: 20px;
            gap: 40px;
        }

        .kit-contents {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            max-width: 800px;
            width: 100%;
        }

        .kit-item {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #333;
            border-radius: 20px;
            padding: 25px 20px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            animation: kitItemFloat 3s ease-in-out infinite;
        }

        .kit-item:nth-child(1) {
            animation-delay: 0s;
        }

        .kit-item:nth-child(2) {
            animation-delay: 0.5s;
        }

        .kit-item:nth-child(3) {
            animation-delay: 1s;
        }

        .kit-item:hover {
            border-color: #00ff00;
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 255, 0, 0.3);
            animation-play-state: paused;
        }

        @keyframes kitItemFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        .kit-item-image {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            border: 2px solid #00ff00;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 255, 0, 0.2);
            transition: all 0.3s ease;
            animation: imageGlow 2s ease-in-out infinite alternate;
        }

        .kit-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .kit-item:hover .kit-item-image {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(0, 255, 0, 0.4);
            animation: imageGlowHover 0.5s ease-in-out;
        }

        .kit-item:hover .kit-item-image img {
            transform: scale(1.05);
        }

        @keyframes imageGlow {
            from {
                box-shadow: 0 8px 20px rgba(0, 255, 0, 0.2);
            }
            to {
                box-shadow: 0 8px 25px rgba(0, 255, 0, 0.3);
            }
        }

        @keyframes imageGlowHover {
            0% {
                box-shadow: 0 8px 20px rgba(0, 255, 0, 0.2);
            }
            50% {
                box-shadow: 0 15px 35px rgba(0, 255, 0, 0.5);
            }
            100% {
                box-shadow: 0 12px 30px rgba(0, 255, 0, 0.4);
            }
        }

        .kit-item-title {
            font-size: 1.5rem;
            color: #ffffff;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            animation: titleGlow 2.5s ease-in-out infinite alternate;
        }

        .kit-item-desc {
            font-size: 1.1rem;
            color: #cccccc;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .kit-item-amount {
            font-size: 1.3rem;
            color: #00ff88;
            font-weight: bold;
            transition: all 0.3s ease;
            animation: amountPulse 2s ease-in-out infinite;
        }

        .kit-item:hover .kit-item-title {
            color: #00ff00;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            transform: scale(1.05);
        }

        .kit-item:hover .kit-item-desc {
            color: #ffffff;
        }

        .kit-item:hover .kit-item-amount {
            color: #00ffaa;
            text-shadow: 0 0 15px rgba(0, 255, 170, 0.6);
            transform: scale(1.1);
        }

        @keyframes titleGlow {
            from {
                text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            }
            to {
                text-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
            }
        }

        @keyframes amountPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
        }

        /* Menu Styles */
        #menu-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        #menu-container .navbar {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #00ff00;
        }

        #menu-container .navbar-nav .nav-link {
            color: #00ff00 !important;
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        #menu-container .navbar-nav .nav-link:hover {
            color: #ffffff !important;
            text-shadow: 0 0 10px #00ff00;
        }

        #menu-container .navbar-text {
            color: #00ff00 !important;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            font-weight: bold;
        }

        #menu-container .navbar-toggler {
            border-color: #00ff00;
        }

        #menu-container .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(0, 255, 0, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }

        /* Adjust first section to account for fixed menu */
        .hero {
            padding-top: 80px;
        }

        /* Menu always collapsed - no responsive adjustments needed */
        #menu-container .navbar-nav .nav-link {
            font-size: 1rem;
        }

        /* Bootstrap collapse functionality */
        #menu-container .navbar-collapse {
            display: none;
        }

        #menu-container .navbar-collapse.show {
            display: block;
        }

        /* Mobile menu styles */
        @media (max-width: 991.98px) {
            #menu-container .navbar-collapse {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.95);
                backdrop-filter: blur(10px);
                border-top: 1px solid #00ff00;
                padding: 1rem;
            }
        }

        /* Purchase Interface */
        .purchase-interface {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #00ff00;
            border-radius: 25px;
            padding: 40px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 20px 40px rgba(0, 255, 0, 0.2);
        }

        .purchase-title {
            font-size: 2.2rem;
            color: #00ff00;
            margin-bottom: 25px;
            text-align: center;
        }

        .quantity-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .quantity-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(0, 255, 136, 0.3);
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'VT323', monospace;
        }

        .quantity-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: rgba(0, 255, 136, 0.5);
            transform: scale(1.1);
        }

        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .quantity-display {
            font-size: 2.2rem;
            font-weight: bold;
            color: #00ff88;
            min-width: 60px;
            text-align: center;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            padding: 10px;
        }

        .cost-breakdown {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .cost-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .cost-row:last-child {
            margin-bottom: 0;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 1.4rem;
            font-weight: bold;
        }

        .cost-label {
            color: #cccccc;
        }

        .cost-value {
            color: #00aaff;
            font-weight: bold;
        }

        .total-cost {
            color: #00ff88 !important;
        }

        .usd-price {
            color: #888888;
            font-size: 0.9rem;
            margin-left: 8px;
            font-style: italic;
        }

        .purchase-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 1.4rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'VT323', monospace;
            margin-bottom: 15px;
            position: relative;
            background: linear-gradient(45deg, #00ff88, #00aaff);
            color: #000;
        }

        .purchase-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 255, 136, 0.4);
        }

        .purchase-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-loading {
            color: transparent !important;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            top: 50%;
            left: 50%;
            margin-left: -12px;
            margin-top: -12px;
            border: 3px solid transparent;
            border-top: 3px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status messages */
        .status-message {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            display: none;
        }

        .status-message.loading {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid rgba(255, 255, 0, 0.3);
            color: #ffff00;
        }

        .status-message.success {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #00ff00;
        }

        .status-message.error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff4444;
        }

        /* Kit Preview */
        .kit-preview {
            text-align: center;
            margin-bottom: 40px;
        }

        .preview-title {
            font-size: 1.8rem;
            color: #00ff00;
            margin-bottom: 15px;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .preview-item {
            text-align: center;
        }

        .preview-image {
            width: 80px;
            height: 80px;
            border: 2px solid #00ff00;
            border-radius: 10px;
            margin: 0 auto 10px;
            overflow: hidden;
        }

        .preview-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-label {
            font-size: 1rem;
            color: #cccccc;
        }

        /* Network warning */
        .network-warning {
            background: rgba(255, 136, 0, 0.1);
            border: 1px solid rgba(255, 136, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            color: #ff8800;
            text-align: center;
            display: none;
        }

        .network-warning button {
            background: rgba(255, 136, 0, 0.2);
            border: 1px solid rgba(255, 136, 0, 0.5);
            color: #ff8800;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 10px;
            font-weight: 600;
            font-family: 'VT323', monospace;
        }

        .network-warning button:hover {
            background: rgba(255, 136, 0, 0.3);
        }



        /* Contract Info */
        .contract-info {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            text-align: left;
        }

        .contract-info h4 {
            color: #00ff00;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .contract-detail {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .contract-detail strong {
            color: #00aaff;
        }

        .contract-address {
            font-family: monospace;
            color: #cccccc;
            word-break: break-all;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .kit-contents {
                grid-template-columns: 1fr;
                gap: 20px;
                max-width: 500px;
            }

            .purchase-interface {
                max-width: 500px;
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .hero {
                padding: 60px 20px 30px 20px;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .section-title {
                font-size: 2.5rem;
            }



            .kit-contents {
                gap: 20px;
            }

            .kit-item {
                padding: 20px;
            }

            .kit-item-image {
                width: 120px;
                height: 120px;
            }

            .purchase-interface {
                padding: 25px;
            }

            .preview-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* Fade in animations */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- Include the menu -->
    <div id="menu-container"></div>
    <script>
      // Load the menu with inline script to avoid conflicts
      fetch('components/menu.html')
        .then(response => response.text())
        .then(html => {
          document.getElementById('menu-container').innerHTML = html;
          
          // Add Bootstrap functionality for menu toggle
          const navbarToggler = document.querySelector('.navbar-toggler');
          const navbarCollapse = document.querySelector('.navbar-collapse');
          
          if (navbarToggler && navbarCollapse) {
            navbarToggler.addEventListener('click', function() {
              navbarCollapse.classList.toggle('show');
            });
          }
        })
        .catch(error => console.error('Error loading menu:', error));
    </script>

    <!-- Hero Section -->
    <section class="hero">
        <h1>AdrianLAB Starter Kit</h1>
        <p class="subtitle">Everything you need to begin your digital evolution</p>
        <p class="description">
            Get your AdrianZERO NFT, Floppy Disc with traits, and $ADRIAN tokens all in one purchase. 
            Pay with ETH and receive everything instantly!
        </p>
        

    </section>

    <!-- Network Warning -->
    <div id="networkWarning" class="network-warning">
        <span>‚ö†Ô∏è Please switch to Base Network</span>
        <button onclick="switchToBase()">Switch Network</button>
    </div>



    <!-- Kit Sale Section -->
    <section class="kit-section">
        <div class="kit-container">
            <!-- Kit Contents -->
            <div class="kit-contents">
                <div class="kit-item fade-in">
                    <div class="kit-item-image">
                        <img src="https://adrianlab.vercel.app/api/render/1" alt="AdrianZERO NFT">
                    </div>
                    <h3 class="kit-item-title">AdrianZERO NFT</h3>
                    <p class="kit-item-desc">Base character NFT</p>
                    <p class="kit-item-amount">1 NFT</p>
                </div>

                <div class="kit-item fade-in">
                    <div class="kit-item-image">
                        <img src="https://adrianlab-kt4ehqbtn-adrianlab.vercel.app/labimages/10002.gif" alt="STARTER Floppy Disc">
                    </div>
                    <h3 class="kit-item-title">STARTER Floppy Disc</h3>
                    <p class="kit-item-desc">Contains rare traits to customize</p>
                    <p class="kit-item-amount">1 Disc</p>
                </div>

                <div class="kit-item fade-in">
                    <div class="kit-item-image">
                        <img src="https://adrianlab.vercel.app/api/render/148" alt="$ADRIAN Tokens">
                    </div>
                    <h3 class="kit-item-title">$ADRIAN Tokens</h3>
                    <p class="kit-item-desc">Ecosystem currency</p>
                    <p class="kit-item-amount" id="adrianTokenAmount">Loading...</p>
                </div>
            </div>

            <!-- Purchase Interface -->
            <div class="purchase-interface fade-in">
                <h3 class="purchase-title">Buy Kit</h3>
                
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick="changeQuantity(-1)" id="decreaseBtn">-</button>
                    <div class="quantity-display" id="quantity">1</div>
                    <button class="quantity-btn" onclick="changeQuantity(1)" id="increaseBtn">+</button>
                </div>

                <div class="cost-breakdown">
                    <div class="cost-row">
                        <span class="cost-label">Price per kit:</span>
                        <span class="cost-value" id="pricePerKit">Loading...</span>
                        <span class="usd-price" id="usdPrice">(Loading USD)</span>
                    </div>
                    <div class="cost-row">
                        <span class="cost-label">Quantity:</span>
                        <span class="cost-value" id="quantityDisplay">1</span>
                    </div>
                    <div class="cost-row">
                        <span class="cost-label">Total Cost:</span>
                        <span class="cost-value total-cost" id="totalCost">Loading...</span>
                        <span class="usd-price" id="totalUsdPrice">(Loading USD)</span>
                    </div>
                </div>

                <!-- Wallet Connection -->
                <div class="wallet-section">
                    <button id="connectBtn" class="connect-btn">Connect Wallet</button>
                    <div id="walletInfo" class="wallet-info">
                        <div class="wallet-address" id="walletAddress"></div>
                    </div>
                </div>

                <button class="purchase-btn" id="purchaseBtn" onclick="buyKit()" disabled>
                    Buy Starter Kit
                </button>

                <div class="status-message" id="statusMessage"></div>

                <!-- Contract Info -->
                <div class="contract-info" style="display: none;" id="contractInfo">
                    <h4>Contract Information</h4>
                    <div class="contract-detail">
                        <strong>Kit Price:</strong> <span id="kitPriceInfo">Loading...</span>
                    </div>
                    <div class="contract-detail">
                        <strong>Status:</strong> <span id="kitStatusInfo">Loading...</span>
                    </div>
                    <div class="contract-detail">
                        <strong>Contract:</strong> <span id="contractAddress" class="contract-address">0xF278a1060900005aD5b9077602b09A513541f5d2</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kit Preview -->
        <div class="kit-preview fade-in">
            <h3 class="preview-title">What you'll receive:</h3>
            <div class="preview-grid">
                <div class="preview-item">
                    <div class="preview-image">
                        <img src="https://adrianlab.vercel.app/api/render/1" alt="NFT">
                    </div>
                    <div class="preview-label">1 AdrianZERO</div>
                </div>
                <div class="preview-item">
                    <div class="preview-image">
                        <img src="https://adrianlab-kt4ehqbtn-adrianlab.vercel.app/labimages/10002.gif" alt="Disc">
                    </div>
                    <div class="preview-label">1 STARTER Floppy</div>
                </div>
                <div class="preview-item">
                    <div class="preview-image">
                        <img src="https://adrianlab.vercel.app/api/render/148" alt="Tokens">
                    </div>
                    <div class="preview-label" id="tokenPreviewLabel">Loading...</div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Contract configuration
        const KIT_SALE_CONTRACT = "0xF278a1060900005aD5b9077602b09A513541f5d2";
        const BASE_CHAIN_ID = 8453;
        const BASE_CHAIN_ID_HEX = "0x2105";

        // Contract ABI - Correct functions from the actual contract
        const KIT_SALE_ABI = [
            "function buyKit() payable",
            "function buyMultipleKits(uint256 quantity) payable",
            "function getKitConfig() view returns (tuple(uint256 priceInETH, uint256 adrianTokenAmount, uint256 floppyTokenId, uint256 erc721Amount, bool active))",
            "function getKitPrice() view returns (uint256)",
            "function getKitTotalCost(uint256 quantity) view returns (uint256)",
            "function canBuyKit(address user, uint256 quantity) view returns (tuple(bool canPurchase, string error, uint256 totalCost, uint256 contractAdrianBalance, uint256 maxKitsAvailable))",
            "function kitSalePaused() view returns (bool)",
            "function maxKitsPerTransaction() view returns (uint256)",
            "function getAdrianTokenBalance() view returns (uint256)",
            "function getSystemStats() view returns (tuple(uint256 totalKitsSold, uint256 totalETHReceived, uint256 adrianTokenBalance, bool systemPaused, bool kitActive, address treasuryWallet))"
        ];

        // Global state
        let provider;
        let signer;
        let userAddress;
        let kitSaleContract;
        let currentQuantity = 1;
        let kitPrice = ethers.utils.parseEther("0");
        let adrianTokenAmount = ethers.utils.parseEther("0");
        let maxKitsPerTransaction = 10;
        let ethPriceUSD = 0;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkConnection();
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            setupFadeInAnimations();
            fetchETHPrice(); // Get ETH price on page load
        });

        async function checkConnection() {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        await connectWallet();
                    }
                } catch (error) {
                    console.error("Connection check failed:", error);
                }
            }
        }

        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    showStatus('Please install MetaMask!', 'error');
                    return;
                }

                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                
                // Check network
                await ensureCorrectNetwork();
                
                // Initialize contract
                kitSaleContract = new ethers.Contract(KIT_SALE_CONTRACT, KIT_SALE_ABI, signer);
                
                // Update UI
                document.getElementById('connectBtn').style.display = 'none';
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('walletAddress').textContent = 
                    `${userAddress.slice(0,6)}...${userAddress.slice(-4)}`;
                
                // Load contract data
                await loadContractData();
                
                showStatus('Wallet connected successfully!', 'success');
                
            } catch (error) {
                console.error('Connection error:', error);
                showStatus('Failed to connect wallet', 'error');
            }
        }

        async function ensureCorrectNetwork() {
            try {
                const { chainId } = await provider.getNetwork();
                if (chainId !== BASE_CHAIN_ID) {
                    document.getElementById('networkWarning').style.display = 'block';
                    throw new Error('Wrong network. Please switch to Base.');
                } else {
                    document.getElementById('networkWarning').style.display = 'none';
                }
            } catch (error) {
                console.error('Network check failed:', error);
                throw error;
            }
        }

        async function switchToBase() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: BASE_CHAIN_ID_HEX }]
                });
                
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
                
            } catch (switchError) {
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: BASE_CHAIN_ID_HEX,
                                chainName: 'Base',
                                nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                rpcUrls: ['https://mainnet.base.org'],
                                blockExplorerUrls: ['https://basescan.org']
                            }]
                        });
                        
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                        
                    } catch (addError) {
                        console.error('Add network error:', addError);
                    }
                }
            }
        }

        async function loadContractData() {
            try {
                // Load kit configuration using getKitConfig
                const kitConfig = await kitSaleContract.getKitConfig();
                kitPrice = kitConfig.priceInETH;
                adrianTokenAmount = kitConfig.adrianTokenAmount;
                maxKitsPerTransaction = await kitSaleContract.maxKitsPerTransaction();
                
                // Update UI with kit info
                const priceEth = ethers.utils.formatEther(kitPrice);
                const adrianAmount = ethers.utils.formatEther(adrianTokenAmount);
                
                document.getElementById('pricePerKit').textContent = `${parseFloat(priceEth).toFixed(4)} ETH`;
                document.getElementById('adrianTokenAmount').textContent = `${parseInt(adrianAmount).toLocaleString()} $ADRIAN`;
                document.getElementById('tokenPreviewLabel').textContent = `${parseInt(adrianAmount).toLocaleString()} $ADRIAN`;
                
                updateTotalCost();
                
                // Check if contract is paused and kit is active
                const isPaused = await kitSaleContract.kitSalePaused();
                
                // Enable purchase button if contract is not paused and kit is active
                if (!isPaused && kitConfig.active) {
                    document.getElementById('purchaseBtn').disabled = false;
                } else {
                    document.getElementById('purchaseBtn').disabled = true;
                    if (isPaused) {
                        showStatus('Kit sales are currently paused', 'error');
                    } else if (!kitConfig.active) {
                        showStatus('Kit sales are not active', 'error');
                    }
                }
                
                // Load additional info
                await loadContractInfo();
                
            } catch (error) {
                console.error('Error loading contract data:', error);
                showStatus('Error loading contract data: ' + error.message, 'error');
            }
        }

        async function loadContractInfo() {
            try {
                const isPaused = await kitSaleContract.kitSalePaused();
                const kitConfig = await kitSaleContract.getKitConfig();
                
                document.getElementById('kitPriceInfo').textContent = 
                    `${parseFloat(ethers.utils.formatEther(kitPrice)).toFixed(4)} ETH`;
                document.getElementById('kitStatusInfo').textContent = 
                    (!isPaused && kitConfig.active) ? 'Active' : 'Inactive';
                
                document.getElementById('contractInfo').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading contract info:', error);
            }
        }

        function changeQuantity(delta) {
            const newQuantity = currentQuantity + delta;
            if (newQuantity >= 1 && newQuantity <= maxKitsPerTransaction) {
                currentQuantity = newQuantity;
                document.getElementById('quantity').textContent = currentQuantity;
                document.getElementById('quantityDisplay').textContent = currentQuantity;
                updateTotalCost();
            }
        }

        function updateTotalCost() {
            if (!kitPrice) return;
            
            const totalWei = kitPrice.mul(currentQuantity);
            const totalEth = ethers.utils.formatEther(totalWei);
            
            document.getElementById('totalCost').textContent = `${parseFloat(totalEth).toFixed(4)} ETH`;
            
            // Update USD prices if available
            updateUSDPrices();
        }

        // Fetch ETH price from CoinGecko API
        async function fetchETHPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd');
                const data = await response.json();
                
                if (data.ethereum && data.ethereum.usd) {
                    ethPriceUSD = data.ethereum.usd;
                    updateUSDPrices();
                }
            } catch (error) {
                console.error('Error fetching ETH price:', error);
                // Fallback to Binance API
                try {
                    const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT');
                    const data = await response.json();
                    
                    if (data.price) {
                        ethPriceUSD = parseFloat(data.price);
                        updateUSDPrices();
                    }
                } catch (fallbackError) {
                    console.error('Error fetching ETH price from fallback:', fallbackError);
                }
            }
        }

        // Update USD prices display
        function updateUSDPrices() {
            if (ethPriceUSD > 0 && kitPrice) {
                // Calculate kit price in USD
                const kitPriceEth = parseFloat(ethers.utils.formatEther(kitPrice));
                const kitPriceUSD = kitPriceEth * ethPriceUSD;
                
                // Calculate total price in USD
                const totalPriceEth = parseFloat(ethers.utils.formatEther(kitPrice.mul(currentQuantity)));
                const totalPriceUSD = totalPriceEth * ethPriceUSD;
                
                // Update displays
                document.getElementById('usdPrice').textContent = `($${kitPriceUSD.toFixed(2)} USD)`;
                document.getElementById('totalUsdPrice').textContent = `($${totalPriceUSD.toFixed(2)} USD)`;
            }
        }

        async function buyKit() {
            if (!userAddress || !kitSaleContract) {
                showStatus('Connect wallet first!', 'error');
                return;
            }
            
            try {
                const button = document.getElementById('purchaseBtn');
                button.disabled = true;
                button.classList.add('btn-loading');
                
                // Validate purchase
                showStatus('Validating purchase...', 'loading');
                const validation = await kitSaleContract.canBuyKit(userAddress, currentQuantity);
                
                if (!validation.canPurchase) {
                    showStatus(`Cannot purchase: ${validation.error}`, 'error');
                    return;
                }
                
                // Calculate total cost
                const totalCost = await kitSaleContract.getKitTotalCost(currentQuantity);
                
                // Check user balance
                const balance = await provider.getBalance(userAddress);
                if (balance.lt(totalCost)) {
                    showStatus('Insufficient ETH balance', 'error');
                    return;
                }
                
                // Execute purchase
                showStatus(`Purchasing ${currentQuantity} kit(s)...`, 'loading');
                
                let tx;
                if (currentQuantity === 1) {
                    tx = await kitSaleContract.buyKit({ value: totalCost });
                } else {
                    tx = await kitSaleContract.buyMultipleKits(currentQuantity, { value: totalCost });
                }
                
                showStatus('Transaction submitted. Waiting for confirmation...', 'loading');
                await tx.wait();
                
                showStatus(`üéâ Successfully purchased ${currentQuantity} kit(s)! Check your wallet for your new assets.`, 'success');
                
            } catch (error) {
                console.error('Purchase error:', error);
                showStatus('Purchase failed: ' + parseError(error), 'error');
            } finally {
                const button = document.getElementById('purchaseBtn');
                button.disabled = false;
                button.classList.remove('btn-loading');
            }
        }

        function showStatus(message, statusType) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = `status-message ${statusType}`;
            statusEl.textContent = message;
            statusEl.style.display = 'block';
            
            if (statusType === 'success') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 10000);
            }
        }

        function parseError(error) {
            if (error.code === 4001) {
                return 'Transaction rejected by user';
            } else if (error.message && error.message.includes('insufficient funds')) {
                return 'Insufficient funds';
            } else if (error.message && error.message.includes('user rejected')) {
                return 'Transaction rejected';
            } else {
                return error.message || 'Unknown error occurred';
            }
        }

        function setupFadeInAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(function(entry) {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);

            const fadeElements = document.querySelectorAll('.fade-in');
            fadeElements.forEach(function(el) {
                observer.observe(el);
            });
        }

        // Listen for account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    window.location.reload();
                } else {
                    connectWallet();
                }
            });

            window.ethereum.on('chainChanged', function () {
                window.location.reload();
            });
        }
    </script>
</body>
</html>